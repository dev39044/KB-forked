#!/bin/bash

#########################################	
# This script checks if XXXXXXX's DNS	# 	
# servers are alive.					#
#########################################	

# Defining hosts to monitor
HOSTS="<HOST1> <HOST2>"

# ping count
COUNT=10

# assing result file
file=results.txt

# assing error file
E=packets.err

# Enter correct script folder
cd /root/monitoring

# Remove old mon files
rm -f $E $file

# Checking for packet loss
for myHost in $HOSTS
do
  count=$(ping -c $COUNT $myHost | grep 'received' |cut -d" " -f4) 
  if (( $count <  5 )) ; then
    	echo "DNS host : $myHost is down or packet loss exist at $(date)" >> $E
  	ping -c 15 $myHost >> $E
  fi
done

# Sending email with results
if [[ -s  "$E" ]] ; then
	# Adding some email fields in the sum file
        echo    'To:<DEST-EMAIL-ADDRESS>'           > $file
        echo    'From:<YOUR-EMAIL-ADDRESS>'         >> $file
        echo    'Subject: DNS Monitoring'  			>> $file
	echo 	' '
	cat 	$E >> $file
	echo 	' ' 
	/usr/sbin/ssmtp <DEST-EMAIL-ADDRESS> < $file
fi

